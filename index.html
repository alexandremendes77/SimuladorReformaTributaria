<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formul√°rio de Solicita√ß√£o de Demandas de TI e Inova√ß√£o</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --background: hsl(0 0% 100%);
            --foreground: hsl(0 0% 20%);
            --card: hsl(0 0% 100%);
            --card-foreground: hsl(0 0% 20%);
            --popover: hsl(0 0% 100%);
            --popover-foreground: hsl(0 0% 20%);
            --primary: hsl(205.4 98.6% 27.3%);
            --primary-foreground: hsl(0 0% 100%);
            --secondary: hsl(220 14.3% 95.9%);
            --secondary-foreground: hsl(215 13.8% 34.1%);
            --muted: hsl(210 20% 98%);
            --muted-foreground: hsl(220 8.9% 46.1%);
            --accent: hsl(204 93.8% 93.7%);
            --accent-foreground: hsl(224.4 64.3% 32.9%);
            --destructive: hsl(0 84.2% 60.2%);
            --destructive-foreground: hsl(0 0% 100%);
            --border: hsl(220 13% 91%);
            --input: hsl(220 13% 91%);
            --ring: hsl(217.2 91.2% 59.8%);
            --radius: 0.375rem;
        }

        * {
            box-sizing: border-box;
        }
        
        html {
            height: 100vh;
            overflow: hidden !important;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            height: 100vh;
            overflow: hidden !important;
            margin: 0;
            padding: 0;
            position: fixed;
            width: 100%;
            overscroll-behavior: none;
        }
        
        .preview-content {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        /* Configura√ß√µes de scroll personalizadas */
        #chat-container::-webkit-scrollbar {
            width: 6px;
        }
        #chat-container::-webkit-scrollbar-thumb {
            background-color: var(--border);
            border-radius: 3px;
        }
        #chat-container::-webkit-scrollbar-track {
            background-color: transparent;
        }
        #chat-container {
            scrollbar-width: thin;
            scrollbar-color: var(--border) transparent;
            scroll-behavior: smooth;
        }
        
        /* Garante que apenas o chat tenha scroll */
        .overflow-y-auto {
            overflow-y: auto !important;
            overflow-x: hidden !important;
        }
        
        /* Remove qualquer scroll da p√°gina principal */
        #main-grid, #chat-column, #preview-column {
            overflow: hidden;
        }
        
        /* Garante altura fixa para containers */
        .h-full {
            height: 100% !important;
        }
        
        .flex-1 {
            flex: 1 1 0% !important;
        }
        
        .min-h-0 {
            min-height: 0px !important;
        }
        
        /* Ajustes espec√≠ficos para mobile */
        @media (max-width: 640px) {
            body {
                padding: 0;
            }
            
            #chat-container {
                padding-right: 8px;
                max-height: calc(100vh - 280px) !important; /* Limita altura para deixar espa√ßo para input */
            }
            
            .space-y-4 > * + * {
                margin-top: 12px;
            }
            
            /* Reduz padding dos bot√µes em mobile */
            button {
                padding: 8px 16px !important;
            }
            
            /* Ajusta altura m√≠nima do textarea em mobile */
            textarea {
                min-height: 80px !important;
            }
            
            /* Garante que o input container tenha altura fixa */
            #input-container {
                min-height: 120px;
                max-height: 120px;
            }
            
            /* Ajusta o container principal em mobile */
            #chat-column .bg-card {
                max-height: calc(100vh - 120px);
            }
            
            /* For√ßa o bot√£o a sempre ficar vis√≠vel */
            #input-container button {
                position: sticky;
                bottom: 0;
                z-index: 10;
            }
            
            /* Ajusta altura do t√≠tulo em mobile */
            #chat-column h2 {
                margin-bottom: 8px !important;
                padding-bottom: 8px !important;
            }
            
            /* Garante que inputs de data sejam vis√≠veis no mobile */
            input[type="date"] {
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
                background-color: var(--background) !important;
                border: 1px solid var(--border) !important;
                padding: 12px !important;
                font-size: 16px !important; /* Evita zoom no iOS */
                min-height: 48px !important; /* Altura m√≠nima para touch */
                width: 100% !important;
                display: block !important;
                visibility: visible !important;
                opacity: 1 !important;
            }
            
            /* Estilo espec√≠fico para o seletor de data no mobile */
            input[type="date"]::-webkit-calendar-picker-indicator {
                background: transparent;
                bottom: 0;
                color: transparent;
                cursor: pointer;
                height: auto;
                left: 0;
                position: absolute;
                right: 0;
                top: 0;
                width: auto;
            }
            
            /* Ajustes espec√≠ficos para a p√°gina de preview no mobile */
            #preview-column .bg-card {
                max-height: calc(100vh - 100px);
            }
            
            #preview-column .overflow-y-auto {
                max-height: calc(100vh - 200px);
                padding-bottom: 20px;
            }
            
            #preview-column h2 {
                margin-bottom: 8px !important;
                padding-bottom: 8px !important;
            }
            
            #sendEmailButton {
                position: sticky;
                bottom: 0;
                z-index: 10;
                margin-top: 12px !important;
            }
        }
        
        /* Estilos gerais para inputs de data */
        input[type="date"] {
            background-color: var(--background);
            border: 1px solid var(--border);
            color: var(--foreground);
            font-family: inherit;
        }
        
        input[type="date"]:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        .chat-bubble-bot {
            animation: slideInUp 0.5s ease-out;
        }
        .chat-bubble-user {
            animation: slideInUp 0.5s ease-out;
        }
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .typing-indicator span {
            animation: blink 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes blink {
            0%, 80%, 100% {
                opacity: 0;
            }
            40% {
                opacity: 1;
            }
        }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        background: 'var(--background)',
                        foreground: 'var(--foreground)',
                        card: 'var(--card)',
                        'card-foreground': 'var(--card-foreground)',
                        primary: 'var(--primary)',
                        'primary-foreground': 'var(--primary-foreground)',
                        secondary: 'var(--secondary)',
                        'secondary-foreground': 'var(--secondary-foreground)',
                        muted: 'var(--muted)',
                        'muted-foreground': 'var(--muted-foreground)',
                        accent: 'var(--accent)',
                        'accent-foreground': 'var(--accent-foreground)',
                        destructive: 'var(--destructive)',
                        'destructive-foreground': 'var(--destructive-foreground)',
                        border: 'var(--border)',
                        input: 'var(--input)',
                        ring: 'var(--ring)',
                    },
                    borderRadius: {
                        lg: 'var(--radius)',
                        md: `calc(var(--radius) - 2px)`,
                        sm: `calc(var(--radius) - 4px)`
                    }
                }
            }
        }
    </script>
</head>
<body class="antialiased">

    <div class="w-full h-screen p-1 sm:p-4 flex justify-center overflow-hidden">
        <div id="main-grid" class="grid gap-2 sm:gap-8 justify-items-center lg:grid-cols-2 lg:gap-16 h-full w-full max-w-7xl overflow-hidden">
            
            <!-- Coluna do Formul√°rio -->
            <div id="chat-column" class="w-full max-w-4xl h-full flex flex-col overflow-hidden">
                <h2 class="text-xl sm:text-2xl font-semibold mb-3 sm:mb-6 pb-2 sm:pb-3 text-card-foreground flex items-center gap-3 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 sm:w-7 sm:h-7 text-primary"><path stroke-linecap="round" stroke-linejoin="round" d="M8.625 12a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H8.25m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0H12m4.125 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 0 1-2.555-.337A5.972 5.972 0 0 1 5.41 20.97a5.969 5.969 0 0 1-.474-.065 4.48 4.48 0 0 0 .978-2.025c.09-.455.09-.934.09-1.425v-2.288a4.5 4.5 0 0 1 .64-2.288Z" /></svg>
                    Me conte sobre sua demanda
                </h2>
                <div class="bg-card p-3 sm:p-6 rounded-lg border border-border shadow-sm flex-1 flex flex-col overflow-hidden">
                    <div id="chat-container" class="pr-2 space-y-4 overflow-y-auto flex-1 min-h-0 max-h-full">
                        <!-- Chat messages will be appended here -->
                    </div>
                    <div id="typing-indicator" class="hidden flex items-center p-2">
                         <div class="w-8 h-8 rounded-full bg-muted flex items-center justify-center mr-3">
                             <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-muted-foreground"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" /></svg>
                         </div>
                        <div class="bg-muted text-muted-foreground rounded-lg p-3">
                            <div class="typing-indicator">
                                <span class="w-2 h-2 inline-block bg-muted-foreground rounded-full"></span>
                                <span class="w-2 h-2 inline-block bg-muted-foreground rounded-full"></span>
                                <span class="w-2 h-2 inline-block bg-muted-foreground rounded-full"></span>
                            </div>
                        </div>
                    </div>
                     <div id="input-container" class="mt-3 sm:mt-4 pt-3 sm:pt-4 border-t border-border flex-shrink-0">
                        <!-- Input fields will be appended here -->
                    </div>
                </div>
            </div>

            <!-- Coluna do Preview -->
            <div id="preview-column" class="hidden w-full max-w-4xl h-full flex flex-col overflow-hidden">
                 <h2 class="text-xl sm:text-2xl font-semibold mb-3 sm:mb-6 pb-2 sm:pb-3 text-card-foreground flex items-center gap-3 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 sm:w-7 sm:h-7 text-primary"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 9.776c.112-.017.227-.026.344-.026h15.812c.117 0 .232.009.344.026m-16.5 0a2.25 2.25 0 00-1.883 2.542l.857 6a2.25 2.25 0 002.227 1.932H19.05a2.25 2.25 0 002.227-1.932l.857-6a2.25 2.25 0 00-1.883-2.542m-16.5 0A2.25 2.25 0 013.75 7.5h16.5a2.25 2.25 0 012.25 2.25m-18.75 0h18.75v-1.5A2.25 2.25 0 0019.5 6h-15A2.25 2.25 0 002.25 8.25v1.5z" /></svg>
                    Preview da Solicita√ß√£o
                </h2>
                 <div class="bg-card p-3 sm:p-6 rounded-lg border border-border shadow-sm flex-1 flex flex-col overflow-hidden">
                    <div class="overflow-y-auto flex-1 pb-4">
                    <div id="previewContent" class="space-y-6">
                        <div>
                            <h3 class="text-md font-semibold text-primary">1. Identifica√ß√£o da Demanda</h3>
                            <div class="mt-2 text-sm space-y-1 pl-3 border-l-2 border-border text-muted-foreground">
                                <p><strong>Solicitante:</strong> <span id="previewSolicitante" class="text-foreground"></span></p>
                                <p><strong>Departamento:</strong> <span id="previewDepartamento" class="text-foreground"></span></p>
                                <p><strong>Data da Solicita√ß√£o:</strong> <span id="previewDataSolicitacao" class="text-foreground"></span></p>
                                <p><strong>Prazo Desejado:</strong> <span id="previewPrazoDesejado" class="text-foreground"></span></p>
                                <p><strong>Prioridade:</strong> <span id="previewPrioridade" class="font-semibold"></span></p>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-md font-semibold text-primary">2. Contexto e Dor</h3>
                            <p id="previewContexto" class="mt-2 text-sm pl-3 border-l-2 border-border preview-content text-foreground"></p>
                        </div>
                        <div>
                            <h3 class="text-md font-semibold text-primary">3. Objetivo e Resultado Esperado</h3>
                            <p id="previewObjetivo" class="mt-2 text-sm pl-3 border-l-2 border-border preview-content text-foreground"></p>
                        </div>
                        <div>
                            <h3 class="text-md font-semibold text-primary">4. Requisitos Funcionais</h3>
                            <p id="previewReqFuncionais" class="mt-2 text-sm pl-3 border-l-2 border-border preview-content text-foreground"></p>
                        </div>
                        <div>
                            <h3 class="text-md font-semibold text-primary">5. Requisitos T√©cnicos e Restri√ß√µes</h3>
                            <p id="previewReqTecnicos" class="mt-2 text-sm pl-3 border-l-2 border-border preview-content text-foreground"></p>
                        </div>
                        <div>
                            <h3 class="text-md font-semibold text-primary">6. Usu√°rios e Stakeholders</h3>
                            <p id="previewUsuarios" class="mt-2 text-sm pl-3 border-l-2 border-border preview-content text-foreground"></p>
                        </div>
                        <div>
                            <h3 class="text-md font-semibold text-primary">7. Recursos Dispon√≠veis</h3>
                            <p id="previewRecursos" class="mt-2 text-sm pl-3 border-l-2 border-border preview-content text-foreground"></p>
                        </div>
                        <div>
                            <h3 class="text-md font-semibold text-primary">8. Impacto do N√£o Atendimento</h3>
                            <p id="previewImpacto" class="mt-2 text-sm pl-3 border-l-2 border-border preview-content text-foreground"></p>
                        </div>
                    </div>
                    </div>
                     <div class="flex gap-3 mt-3 sm:mt-6">
                        <button id="restartButton" class="flex-1 bg-secondary text-secondary-foreground font-semibold py-2 px-4 rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-ring transition-opacity flex items-center justify-center gap-2 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99" />
                            </svg>
                             <span>Recome√ßar</span>
                        </button>
                        <button id="sendEmailButton" class="flex-1 bg-primary text-primary-foreground font-semibold py-2 px-4 rounded-lg hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-ring transition-opacity flex items-center justify-center gap-2 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                             <span>Criar Tarefa no Asana</span>
                        </button>
                     </div>
                 </div>
            </div>
        </div>
    </div>

    <!-- Modal de Classifica√ß√£o de Prioridades -->
    <div id="priorityModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
        <div class="bg-card w-full max-w-2xl rounded-lg shadow-xl p-6 relative">
            <button id="closeModalBtn" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-xl font-bold text-card-foreground mb-4">‚ö° Classifica√ß√£o de Prioridades</h2>
            <div class="space-y-4 text-sm">
                <div class="p-4 rounded-md border border-red-200 bg-red-50/50">
                    <h3 class="font-semibold text-red-800 flex items-center gap-2">üî¥ CR√çTICA</h3>
                    <p class="text-red-700 mt-1"><strong>Defini√ß√£o:</strong> Para sistema fora do ar ou falhas que impedem a opera√ß√£o do neg√≥cio.</p>
                    <p class="text-red-700 mt-1"><strong>Impacto:</strong> Todo o neg√≥cio ou uma √°rea cr√≠tica √© afetado.</p>
                    <p class="text-red-700 mt-1"><strong>SLA:</strong> Resposta imediata.</p>
                </div>
                 <div class="p-4 rounded-md border border-orange-200 bg-orange-50/50">
                    <h3 class="font-semibold text-orange-800 flex items-center gap-2">üü† ALTA</h3>
                    <p class="text-orange-700 mt-1"><strong>Defini√ß√£o:</strong> Impacta significativamente a produtividade de m√∫ltiplos usu√°rios ou processos importantes.</p>
                    <p class="text-orange-700 mt-1"><strong>SLA:</strong> Resposta em at√© 24h.</p>
                </div>
                 <div class="p-4 rounded-md border border-yellow-200 bg-yellow-50/50">
                    <h3 class="font-semibold text-yellow-800 flex items-center gap-2">üü° M√âDIA</h3>
                    <p class="text-yellow-700 mt-1"><strong>Defini√ß√£o:</strong> Melhorias de processo ou novas funcionalidades importantes com impacto moderado na produtividade.</p>
                    <p class="text-yellow-700 mt-1"><strong>SLA:</strong> Resposta em at√© 3 dias √∫teis.</p>
                </div>
                 <div class="p-4 rounded-md border border-green-200 bg-green-50/50">
                    <h3 class="font-semibold text-green-800 flex items-center gap-2">üü¢ BAIXA</h3>
                    <p class="text-green-700 mt-1"><strong>Defini√ß√£o:</strong> Melhorias menores ou funcionalidades "nice-to-have" sem impacto cr√≠tico no neg√≥cio.</p>
                    <p class="text-green-700 mt-1"><strong>SLA:</strong> Resposta em at√© 5 dias √∫teis.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Dicas para Contexto -->
    <div id="contextModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
        <div class="bg-card w-full max-w-2xl rounded-lg shadow-xl p-6 relative">
            <button id="closeContextModalBtn" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-xl font-bold text-card-foreground mb-4">üìù Como descrever sua situa√ß√£o</h2>
            <div class="space-y-4 text-sm">
                <div class="p-4 rounded-md border border-blue-200 bg-blue-50/50">
                    <h3 class="font-semibold text-blue-800 flex items-center gap-2">‚ùì Qual problema voc√™ est√° enfrentando?</h3>
                    <p class="text-blue-700 mt-1">Descreva o problema espec√≠fico ou a necessidade que motivou esta solicita√ß√£o.</p>
                </div>
                 <div class="p-4 rounded-md border border-purple-200 bg-purple-50/50">
                    <h3 class="font-semibold text-purple-800 flex items-center gap-2">üéØ Como isso impacta seu trabalho/departamento?</h3>
                    <p class="text-purple-700 mt-1">Explique as consequ√™ncias do problema na produtividade, qualidade ou resultados.</p>
                </div>
                 <div class="p-4 rounded-md border border-green-200 bg-green-50/50">
                    <h3 class="font-semibold text-green-800 flex items-center gap-2">‚è∞ Qual a frequ√™ncia deste problema?</h3>
                    <p class="text-green-700 mt-1">Indique se acontece diariamente, semanalmente, mensalmente ou em situa√ß√µes espec√≠ficas.</p>
                </div>
                 <div class="p-4 rounded-md border border-orange-200 bg-orange-50/50">
                    <h3 class="font-semibold text-orange-800 flex items-center gap-2">üë• Quantas pessoas s√£o afetadas?</h3>
                    <p class="text-orange-700 mt-1">Informe o n√∫mero de usu√°rios, equipes ou departamentos impactados pelo problema.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Dicas para Objetivo -->
    <div id="objetivoModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
        <div class="bg-card w-full max-w-2xl rounded-lg shadow-xl p-6 relative">
            <button id="closeObjetivoModalBtn" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-xl font-bold text-card-foreground mb-4">üéØ Como definir seu objetivo</h2>
            <div class="space-y-4 text-sm">
                <div class="p-4 rounded-md border border-blue-200 bg-blue-50/50">
                    <h3 class="font-semibold text-blue-800 flex items-center gap-2">üèÜ Qual o resultado final desejado?</h3>
                    <p class="text-blue-700 mt-1">Descreva claramente o que voc√™ quer que aconte√ßa ap√≥s a implementa√ß√£o da solu√ß√£o.</p>
                </div>
                 <div class="p-4 rounded-md border border-green-200 bg-green-50/50">
                    <h3 class="font-semibold text-green-800 flex items-center gap-2">‚úÖ Como voc√™ saber√° que o problema foi resolvido?</h3>
                    <p class="text-green-700 mt-1">Defina crit√©rios objetivos que indicar√£o que a solu√ß√£o est√° funcionando adequadamente.</p>
                </div>
                 <div class="p-4 rounded-md border border-purple-200 bg-purple-50/50">
                    <h3 class="font-semibold text-purple-800 flex items-center gap-2">üìä Quais m√©tricas indicar√£o o sucesso?</h3>
                    <p class="text-purple-700 mt-1">Identifique n√∫meros, percentuais ou indicadores mensur√°veis de melhoria (tempo, custo, qualidade, etc.).</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Dicas para Requisitos Funcionais -->
    <div id="reqFuncionaisModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
        <div class="bg-card w-full max-w-2xl rounded-lg shadow-xl p-6 relative">
            <button id="closeReqFuncionaisModalBtn" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-xl font-bold text-card-foreground mb-4">‚öôÔ∏è Como definir requisitos funcionais</h2>
            <div class="space-y-4 text-sm">
                <div class="p-4 rounded-md border border-blue-200 bg-blue-50/50">
                    <h3 class="font-semibold text-blue-800 flex items-center gap-2">üîß Liste as funcionalidades essenciais</h3>
                    <p class="text-blue-700 mt-1">Descreva as principais funcionalidades que a solu√ß√£o deve ter para resolver o problema.</p>
                </div>
                 <div class="p-4 rounded-md border border-green-200 bg-green-50/50">
                    <h3 class="font-semibold text-green-800 flex items-center gap-2">üîÑ Descreva os fluxos de trabalho necess√°rios</h3>
                    <p class="text-green-700 mt-1">Explique os processos e sequ√™ncias de a√ß√µes que devem ser automatizados ou facilitados.</p>
                </div>
                 <div class="p-4 rounded-md border border-purple-200 bg-purple-50/50">
                    <h3 class="font-semibold text-purple-800 flex items-center gap-2">üîó Inclua integra√ß√µes necess√°rias com outros sistemas</h3>
                    <p class="text-purple-700 mt-1">Identifique quais sistemas, APIs ou ferramentas precisam se conectar com a solu√ß√£o.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Dicas para Requisitos T√©cnicos -->
    <div id="reqTecnicosModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
        <div class="bg-card w-full max-w-2xl rounded-lg shadow-xl p-6 relative">
            <button id="closeReqTecnicosModalBtn" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-xl font-bold text-card-foreground mb-4">üîß Como definir requisitos t√©cnicos</h2>
            <div class="space-y-4 text-sm">
                <div class="p-4 rounded-md border border-blue-200 bg-blue-50/50">
                    <h3 class="font-semibold text-blue-800 flex items-center gap-2">üîó Sistemas que devem ser integrados</h3>
                    <p class="text-blue-700 mt-1">Liste os sistemas, bancos de dados ou APIs que precisam se conectar com a solu√ß√£o.</p>
                </div>
                 <div class="p-4 rounded-md border border-red-200 bg-red-50/50">
                    <h3 class="font-semibold text-red-800 flex items-center gap-2">üí∞ Limita√ß√µes de or√ßamento (se houver)</h3>
                    <p class="text-red-700 mt-1">Informe restri√ß√µes financeiras ou faixas de valores que devem ser respeitadas.</p>
                </div>
                 <div class="p-4 rounded-md border border-orange-200 bg-orange-50/50">
                    <h3 class="font-semibold text-orange-800 flex items-center gap-2">üîí Restri√ß√µes de seguran√ßa/compliance</h3>
                    <p class="text-orange-700 mt-1">Mencione normas, certifica√ß√µes ou pol√≠ticas de seguran√ßa que devem ser seguidas.</p>
                </div>
                 <div class="p-4 rounded-md border border-purple-200 bg-purple-50/50">
                    <h3 class="font-semibold text-purple-800 flex items-center gap-2">‚öôÔ∏è Prefer√™ncias de tecnologia (se houver)</h3>
                    <p class="text-purple-700 mt-1">Indique tecnologias, linguagens ou plataformas preferenciais da empresa.</p>
                </div>
                 <div class="p-4 rounded-md border border-green-200 bg-green-50/50">
                    <h3 class="font-semibold text-green-800 flex items-center gap-2">üì± Necessidade de acesso m√≥vel/remoto</h3>
                    <p class="text-green-700 mt-1">Especifique se a solu√ß√£o deve funcionar em dispositivos m√≥veis ou acesso remoto.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Dicas para Usu√°rios -->
    <div id="usuariosModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
        <div class="bg-card w-full max-w-2xl rounded-lg shadow-xl p-6 relative">
            <button id="closeUsuariosModalBtn" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-xl font-bold text-card-foreground mb-4">üë• Como identificar usu√°rios e stakeholders</h2>
            <div class="space-y-4 text-sm">
                <div class="p-4 rounded-md border border-blue-200 bg-blue-50/50">
                    <h3 class="font-semibold text-blue-800 flex items-center gap-2">üë§ Quem vai usar a solu√ß√£o?</h3>
                    <p class="text-blue-700 mt-1">Identifique os usu√°rios diretos que ir√£o interagir com a solu√ß√£o no dia a dia.</p>
                </div>
                 <div class="p-4 rounded-md border border-green-200 bg-green-50/50">
                    <h3 class="font-semibold text-green-800 flex items-center gap-2">üî¢ Quantos usu√°rios aproximadamente?</h3>
                    <p class="text-green-700 mt-1">Estime o n√∫mero de pessoas que utilizar√£o a solu√ß√£o (5, 50, 500+ usu√°rios).</p>
                </div>
                 <div class="p-4 rounded-md border border-purple-200 bg-purple-50/50">
                    <h3 class="font-semibold text-purple-800 flex items-center gap-2">üíª Perfil t√©cnico dos usu√°rios (b√°sico, intermedi√°rio, avan√ßado)</h3>
                    <p class="text-purple-700 mt-1">Avalie o n√≠vel de conhecimento t√©cnico para adequar a interface e complexidade.</p>
                </div>
                 <div class="p-4 rounded-md border border-orange-200 bg-orange-50/50">
                    <h3 class="font-semibold text-orange-800 flex items-center gap-2">‚úÖ Quem s√£o os respons√°veis por aprovar a solu√ß√£o?</h3>
                    <p class="text-orange-700 mt-1">Identifique gestores ou tomadores de decis√£o que precisam validar a solu√ß√£o.</p>
                </div>
                 <div class="p-4 rounded-md border border-red-200 bg-red-50/50">
                    <h3 class="font-semibold text-red-800 flex items-center gap-2">‚ÑπÔ∏è Quem pode fornecer informa√ß√µes adicionais?</h3>
                    <p class="text-red-700 mt-1">Liste pessoas-chave que podem esclarecer d√∫vidas ou fornecer detalhes t√©cnicos.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Dicas para Recursos -->
    <div id="recursosModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
        <div class="bg-card w-full max-w-2xl rounded-lg shadow-xl p-6 relative">
            <button id="closeRecursosModalBtn" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-xl font-bold text-card-foreground mb-4">üí∞ Como identificar recursos dispon√≠veis</h2>
            <div class="space-y-4 text-sm">
                <div class="p-4 rounded-md border border-green-200 bg-green-50/50">
                    <h3 class="font-semibold text-green-800 flex items-center gap-2">üíµ Existe or√ßamento aprovado? Qual valor?</h3>
                    <p class="text-green-700 mt-1">Informe se h√° verba dispon√≠vel e qual a faixa de valores para investimento.</p>
                </div>
                 <div class="p-4 rounded-md border border-blue-200 bg-blue-50/50">
                    <h3 class="font-semibold text-blue-800 flex items-center gap-2">üë• H√° pessoas do seu departamento dispon√≠veis para colaborar?</h3>
                    <p class="text-blue-700 mt-1">Identifique membros da equipe que podem dedicar tempo ao projeto.</p>
                </div>
                 <div class="p-4 rounded-md border border-purple-200 bg-purple-50/50">
                    <h3 class="font-semibold text-purple-800 flex items-center gap-2">ü§ù Existem fornecedores preferenciais?</h3>
                    <p class="text-purple-700 mt-1">Mencione se h√° parceiros ou fornecedores que devem ser considerados.</p>
                </div>
                 <div class="p-4 rounded-md border border-orange-200 bg-orange-50/50">
                    <h3 class="font-semibold text-orange-800 flex items-center gap-2">üìÑ H√° documenta√ß√£o/dados dispon√≠veis?</h3>
                    <p class="text-orange-700 mt-1">Liste materiais, manuais, bases de dados ou documentos que podem ajudar.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Dicas para Impacto -->
    <div id="impactoModal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 p-4">
        <div class="bg-card w-full max-w-2xl rounded-lg shadow-xl p-6 relative">
            <button id="closeImpactoModalBtn" class="absolute top-4 right-4 text-muted-foreground hover:text-foreground">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-xl font-bold text-card-foreground mb-4">‚ö†Ô∏è Como avaliar o impacto do n√£o atendimento</h2>
            <div class="space-y-4 text-sm">
                <div class="p-4 rounded-md border border-red-200 bg-red-50/50">
                    <h3 class="font-semibold text-red-800 flex items-center gap-2">‚ùå O que acontece se esta demanda n√£o for atendida?</h3>
                    <p class="text-red-700 mt-1">Descreva as consequ√™ncias diretas da n√£o implementa√ß√£o da solu√ß√£o.</p>
                </div>
                 <div class="p-4 rounded-md border border-orange-200 bg-orange-50/50">
                    <h3 class="font-semibold text-orange-800 flex items-center gap-2">‚ö†Ô∏è H√° riscos para o neg√≥cio?</h3>
                    <p class="text-orange-700 mt-1">Identifique riscos operacionais, estrat√©gicos ou de compliance.</p>
                </div>
                 <div class="p-4 rounded-md border border-yellow-200 bg-yellow-50/50">
                    <h3 class="font-semibold text-yellow-800 flex items-center gap-2">üí∏ Existe impacto financeiro?</h3>
                    <p class="text-yellow-700 mt-1">Quantifique perdas financeiras, custos extras ou oportunidades perdidas.</p>
                </div>
                 <div class="p-4 rounded-md border border-blue-200 bg-blue-50/50">
                    <h3 class="font-semibold text-blue-800 flex items-center gap-2">üè¢ Afeta outros departamentos?</h3>
                    <p class="text-blue-700 mt-1">Identifique se outros setores ser√£o impactados pela falta da solu√ß√£o.</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Hidden form for data collection -->
    <form id="hidden-form" class="hidden">
        <input type="text" id="solicitante" name="solicitante">
        <input type="text" id="departamento" name="departamento">
        <input type="date" id="dataSolicitacao" name="dataSolicitacao">
        <input type="date" id="prazoDesejado" name="prazoDesejado">
        <input type="radio" name="prioridade" value="Baixa">
        <input type="radio" name="prioridade" value="M√©dia">
        <input type="radio" name="prioridade" value="Alta">
        <input type="radio" name="prioridade" value="Cr√≠tica">
        <textarea id="contexto" name="contexto"></textarea>
        <textarea id="objetivo" name="objetivo"></textarea>
        <textarea id="reqFuncionais" name="reqFuncionais"></textarea>
        <textarea id="reqTecnicos" name="reqTecnicos"></textarea>
        <textarea id="usuarios" name="usuarios"></textarea>
        <textarea id="recursos" name="recursos"></textarea>
        <textarea id="impacto" name="impacto"></textarea>
    </form>


    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const mainGrid = document.getElementById('main-grid');
            const chatColumn = document.getElementById('chat-column');
            const previewColumn = document.getElementById('preview-column');
            const chatContainer = document.getElementById('chat-container');
            const inputContainer = document.getElementById('input-container');
            const typingIndicator = document.getElementById('typing-indicator');
            const hiddenForm = document.getElementById('hidden-form');
            const sendEmailButton = document.getElementById('sendEmailButton');
            const priorityModal = document.getElementById('priorityModal');
            const closeModalBtn = document.getElementById('closeModalBtn');
            let currentStep = 0;
            let isProcessing = false;

            const questions = [
                { id: 'solicitante', question: 'Ol√°! Para come√ßar, qual √© o seu nome completo?', type: 'text', placeholder: 'Seu nome aqui...' },
                { id: 'departamento', question: 'E de qual departamento voc√™ √©?', type: 'text', placeholder: 'Ex: Vendas, Marketing...' },
                { id: 'contexto', question: 'Descreva a sua dor atual, para pensarmos juntos em uma solu√ß√£o:', type: 'textarea', placeholder: 'Clique no √≠cone de informa√ß√£o ao lado para ver dicas de como responder esta pergunta.', hasInfo: true },
                { id: 'objetivo', question: 'O que voc√™ espera alcan√ßar com a solu√ß√£o e como medir√° o sucesso?', type: 'textarea', placeholder: 'Clique no √≠cone de informa√ß√£o ao lado para ver dicas de como responder esta pergunta.', hasInfo: true },
                { id: 'reqFuncionais', question: 'O que a solu√ß√£o precisa fazer?', type: 'textarea', placeholder: 'Clique no √≠cone de informa√ß√£o ao lado para ver dicas de como responder esta pergunta.', hasInfo: true },
                { id: 'reqTecnicos', question: 'Existem requisitos t√©cnicos ou restri√ß√µes?', type: 'textarea', placeholder: 'Clique no √≠cone de informa√ß√£o ao lado para ver dicas de como responder esta pergunta.', hasInfo: true },
                { id: 'usuarios', question: 'Quem s√£o os usu√°rios e as partes interessadas?', type: 'textarea', placeholder: 'Clique no √≠cone de informa√ß√£o ao lado para ver dicas de como responder esta pergunta.', hasInfo: true },
                { id: 'recursos', question: 'Quais recursos j√° est√£o dispon√≠veis?', type: 'textarea', placeholder: 'Clique no √≠cone de informa√ß√£o ao lado para ver dicas de como responder esta pergunta.', hasInfo: true },
                { id: 'impacto', question: 'Qual o impacto se a demanda n√£o for atendida?', type: 'textarea', placeholder: 'Clique no √≠cone de informa√ß√£o ao lado para ver dicas de como responder esta pergunta.', hasInfo: true },
                { id: 'prazoDesejado', question: 'Qual o prazo desejado para a conclus√£o?', type: 'date' },
                { id: 'prioridade', question: 'Para finalizar, como voc√™ classificaria a prioridade desta demanda?', type: 'radio', options: ['Baixa', 'M√©dia', 'Alta', 'Cr√≠tica'], hasInfo: true }
            ];

            function scrollToBottom() {
                chatContainer.scrollTop = chatContainer.scrollHeight;
                // For√ßa o scroll em caso de layouts din√¢micos
                requestAnimationFrame(() => {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                });
            }

            function addBotMessage(message, hasInfo = false, infoType = 'priority') {
                const messageEl = document.createElement('div');
                messageEl.classList.add('flex', 'items-start', 'chat-bubble-bot');

                let infoButtonHTML = '';
                if (hasInfo) {
                    let buttonClass = 'priority-info-btn';
                    if (infoType === 'context') buttonClass = 'context-info-btn';
                    else if (infoType === 'objetivo') buttonClass = 'objetivo-info-btn';
                    else if (infoType === 'reqFuncionais') buttonClass = 'reqFuncionais-info-btn';
                    else if (infoType === 'reqTecnicos') buttonClass = 'reqTecnicos-info-btn';
                    else if (infoType === 'usuarios') buttonClass = 'usuarios-info-btn';
                    else if (infoType === 'recursos') buttonClass = 'recursos-info-btn';
                    else if (infoType === 'impacto') buttonClass = 'impacto-info-btn';
                    
                    infoButtonHTML = `
                        <button type="button" class="${buttonClass} text-muted-foreground hover:text-primary ml-2 flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                              <path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z" />
                            </svg>
                        </button>
                    `;
                }

                messageEl.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-muted flex items-center justify-center mr-3 flex-shrink-0">
                         <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-muted-foreground"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" /></svg>
                     </div>
                     <div class="bg-muted text-card-foreground rounded-lg p-3 max-w-xs flex items-center">
                        <span>${message}</span>
                        ${infoButtonHTML}
                    </div>
                `;
                chatContainer.appendChild(messageEl);
                // Garante que o scroll aconte√ßa ap√≥s o elemento ser totalmente renderizado
                requestAnimationFrame(() => {
                    setTimeout(scrollToBottom, 50);
                });
            }

            function addUserMessage(message) {
                 const messageEl = document.createElement('div');
                messageEl.classList.add('flex', 'justify-end', 'chat-bubble-user');
                messageEl.innerHTML = `
                    <div class="bg-primary text-primary-foreground rounded-lg p-3 max-w-xs">
                        ${message}
                    </div>
                `;
                chatContainer.appendChild(messageEl);
                // Garante que o scroll aconte√ßa ap√≥s o elemento ser totalmente renderizado
                requestAnimationFrame(() => {
                    setTimeout(scrollToBottom, 50);
                });
            }

            function askQuestion() {
                isProcessing = false;
                if (currentStep >= questions.length) {
                    addBotMessage("Obrigado! Todas as informa√ß√µes foram registradas. O resumo da sua solicita√ß√£o est√° pronto para ser enviado.");
                    inputContainer.innerHTML = '';
                    typingIndicator.classList.add('hidden');
                    setTimeout(() => {
                        chatColumn.classList.add('hidden');
                        previewColumn.classList.remove('hidden');
                    }, 2000);
                    return;
                }
                
                const step = questions[currentStep];
                let infoType = 'priority';
                if (step.id === 'contexto') infoType = 'context';
                else if (step.id === 'objetivo') infoType = 'objetivo';
                else if (step.id === 'reqFuncionais') infoType = 'reqFuncionais';
                else if (step.id === 'reqTecnicos') infoType = 'reqTecnicos';
                else if (step.id === 'usuarios') infoType = 'usuarios';
                else if (step.id === 'recursos') infoType = 'recursos';
                else if (step.id === 'impacto') infoType = 'impacto';
                
                // Personaliza a pergunta do departamento com o nome do usu√°rio
                let questionText = step.question;
                if (step.id === 'departamento') {
                    const nomeUsuario = hiddenForm.elements['solicitante'].value;
                    if (nomeUsuario) {
                        const primeiroNome = nomeUsuario.split(' ')[0];
                        questionText = `E voc√™, ${primeiroNome}, √© de qual departamento?`;
                    }
                }
                
                addBotMessage(questionText, step.hasInfo, infoType);
                inputContainer.innerHTML = '';
                
                let inputEl;
                if (step.type === 'textarea') {
                    inputEl = document.createElement('textarea');
                    inputEl.rows = 4;
                    inputEl.className = 'mt-1 block w-full rounded-md border-input bg-background shadow-sm focus:border-primary focus:ring focus:ring-ring focus:ring-opacity-50';
                    inputEl.placeholder = step.placeholder || '';
                    inputContainer.appendChild(inputEl);

                    const submitBtn = document.createElement('button');
                    submitBtn.textContent = 'Enviar';
                    submitBtn.className = 'mt-2 w-full bg-primary text-primary-foreground font-semibold py-2 px-4 rounded-lg shadow-sm hover:opacity-90';
                    submitBtn.onclick = () => handleAnswer(inputEl.value);
                    inputContainer.appendChild(submitBtn);

                    inputEl.focus();
                } else if (step.type === 'radio') {
                     const radioContainer = document.createElement('div');
                    radioContainer.className = 'grid grid-cols-2 sm:grid-cols-4 gap-3';
                    
                     const colors = { 'Baixa': 'green', 'M√©dia': 'yellow', 'Alta': 'orange', 'Cr√≠tica': 'red' };

                    step.options.forEach(option => {
                        const label = document.createElement('label');
                        label.className = `cursor-pointer flex items-center justify-center gap-2 p-3 border border-input rounded-md text-center hover:bg-accent transition-all`;
                        label.innerHTML = `
                            <input type="radio" name="${step.id}" value="${option}" class="sr-only">
                            <span class="w-3 h-3 bg-${colors[option]}-500 rounded-full"></span>
                            <span class="font-medium text-sm text-card-foreground">${option}</span>
                        `;
                        label.onclick = () => handleAnswer(option, true);
                        radioContainer.appendChild(label);
                    });
                    inputContainer.appendChild(radioContainer);
                } else {
                    inputEl = document.createElement('input');
                    inputEl.type = step.type;
                    inputEl.className = 'mt-1 block w-full rounded-md border-input bg-background shadow-sm focus:border-primary focus:ring focus:ring-ring focus:ring-opacity-50';
                    inputEl.placeholder = step.placeholder || '';
                    
                    // Configura√ß√µes espec√≠ficas para campos de data
                    if (step.type === 'date') {
                        inputEl.style.minHeight = '48px';
                        inputEl.style.fontSize = '16px';
                        inputEl.style.padding = '12px';
                        inputEl.style.display = 'block';
                        inputEl.style.width = '100%';
                        inputEl.style.visibility = 'visible';
                        inputEl.style.opacity = '1';
                        inputEl.style.backgroundColor = 'var(--background)';
                        inputEl.style.border = '1px solid var(--border)';
                        inputEl.style.color = 'var(--foreground)';
                        
                        // Preenche automaticamente com 15 dias √† frente
                        const today = new Date();
                        const futureDate = new Date(today);
                        futureDate.setDate(today.getDate() + 15);
                        
                        // Formata a data para o formato YYYY-MM-DD
                        const year = futureDate.getFullYear();
                        const month = String(futureDate.getMonth() + 1).padStart(2, '0');
                        const day = String(futureDate.getDate()).padStart(2, '0');
                        inputEl.value = `${year}-${month}-${day}`;
                    }
                    
                    inputContainer.appendChild(inputEl);

                    const submitBtn = document.createElement('button');
                    submitBtn.textContent = 'Enviar';
                    submitBtn.className = 'mt-2 w-full bg-primary text-primary-foreground font-semibold py-2 px-4 rounded-lg shadow-sm hover:opacity-90';
                    submitBtn.onclick = () => handleAnswer(inputEl.value);
                    inputContainer.appendChild(submitBtn);

                    // Para campos de data, n√£o fazer focus autom√°tico no mobile para evitar problemas
                    if (step.type !== 'date' || window.innerWidth > 640) {
                        inputEl.focus();
                    }
                    
                    inputEl.onkeydown = (e) => {
                        if (e.key === 'Enter') {
                            handleAnswer(e.target.value);
                        }
                    };
                }
            }

            function handleAnswer(value, isRadio = false) {
                if (isProcessing) return;
                isProcessing = true;

                if (!value || value.trim() === '') {
                    alert("Por favor, forne√ßa uma resposta.");
                    isProcessing = false;
                    return;
                }
                const step = questions[currentStep];
                const hiddenInput = hiddenForm.elements[step.id];

                if (isRadio) {
                    addUserMessage(value);
                     const radioToSelect = Array.from(hiddenInput).find(r => r.value === value);
                    if (radioToSelect) radioToSelect.checked = true;
                } else {
                     addUserMessage(value);
                     hiddenInput.value = value;
                }
               
                updatePreview();
                currentStep++;
                
                inputContainer.innerHTML = '';
                typingIndicator.classList.remove('hidden');
                
                setTimeout(() => {
                    typingIndicator.classList.add('hidden');
                    askQuestion();
                }, 1500);
            }

            function formatDate(dateString) {
                if (!dateString) return '';
                const [year, month, day] = dateString.split('-');
                return `${day}/${month}/${year}`;
            }

            function updatePreview() {
                const formData = new FormData(hiddenForm);
                document.getElementById('previewSolicitante').textContent = formData.get('solicitante');
                document.getElementById('previewDepartamento').textContent = formData.get('departamento');
                document.getElementById('previewDataSolicitacao').textContent = formatDate(hiddenForm.elements['dataSolicitacao'].value);
                document.getElementById('previewPrazoDesejado').textContent = formatDate(formData.get('prazoDesejado'));
                const priority = formData.get('prioridade');
                const previewPriority = document.getElementById('previewPrioridade');
                previewPriority.textContent = priority || '';
                previewPriority.classList.remove('text-green-600', 'text-yellow-600', 'text-orange-600', 'text-red-600');
                switch(priority) {
                    case 'Baixa': previewPriority.classList.add('text-green-600'); break;
                    case 'M√©dia': previewPriority.classList.add('text-yellow-600'); break;
                    case 'Alta': previewPriority.classList.add('text-orange-600'); break;
                    case 'Cr√≠tica': previewPriority.classList.add('text-red-600'); break;
                }
                document.getElementById('previewContexto').textContent = formData.get('contexto');
                document.getElementById('previewObjetivo').textContent = formData.get('objetivo');
                document.getElementById('previewReqFuncionais').textContent = formData.get('reqFuncionais');
                document.getElementById('previewReqTecnicos').textContent = formData.get('reqTecnicos');
                document.getElementById('previewUsuarios').textContent = formData.get('usuarios');
                document.getElementById('previewRecursos').textContent = formData.get('recursos');
                document.getElementById('previewImpacto').textContent = formData.get('impacto');
            }
            

            // Initial setup
            const today = new Date().toISOString().split('T')[0];
            hiddenForm.elements['dataSolicitacao'].value = today;
            updatePreview();

            // Start chat
            askQuestion();

            // Fun√ß√£o para recome√ßar o formul√°rio
            function restartForm() {
                // Reset todas as vari√°veis
                currentStep = 0;
                isProcessing = false;
                
                // Limpa o formul√°rio oculto
                hiddenForm.reset();
                
                // Limpa o chat
                chatContainer.innerHTML = '';
                
                // Limpa o input container
                inputContainer.innerHTML = '';
                
                // Esconde o typing indicator
                typingIndicator.classList.add('hidden');
                
                // Volta para a tela do chat
                previewColumn.classList.add('hidden');
                chatColumn.classList.remove('hidden');
                
                // Atualiza a data atual
                const today = new Date().toISOString().split('T')[0];
                hiddenForm.elements['dataSolicitacao'].value = today;
                
                // Atualiza o preview
                updatePreview();
                
                // Inicia o chat novamente
                askQuestion();
            }

            // Event listener para o bot√£o de recome√ßar
            document.getElementById('restartButton').addEventListener('click', restartForm);

            // Fun√ß√£o para criar tarefa no Asana
            async function createAsanaTask() {
                const formData = new FormData(hiddenForm);
                const today = new Date().toISOString().split('T')[0];
                
                // Formata o prazo desejado para o formato ISO
                const prazoDesejado = formData.get('prazoDesejado');
                const dueOn = prazoDesejado ? prazoDesejado : null;
                
                // Monta a descri√ß√£o da tarefa
                const taskDescription = `
NOVA SOLICITA√á√ÉO DE DEMANDA DE TI

1. IDENTIFICA√á√ÉO DA DEMANDA
Solicitante: ${formData.get('solicitante')}
Departamento: ${formData.get('departamento')}
Data da Solicita√ß√£o: ${formatDate(today)}
Prazo Desejado: ${formatDate(prazoDesejado)}
Prioridade: ${formData.get('prioridade')}

2. CONTEXTO E DOR
${formData.get('contexto')}

3. OBJETIVO E RESULTADO ESPERADO
${formData.get('objetivo')}

4. REQUISITOS FUNCIONAIS
${formData.get('reqFuncionais')}

5. REQUISITOS T√âCNICOS E RESTRI√á√ïES
${formData.get('reqTecnicos')}

6. USU√ÅRIOS E STAKEHOLDERS
${formData.get('usuarios')}

7. RECURSOS DISPON√çVEIS
${formData.get('recursos')}

8. IMPACTO DO N√ÉO ATENDIMENTO
${formData.get('impacto')}
                `.trim();

                const taskData = {
                    data: {
                        name: `Nova Solicita√ß√£o de TI - ${formData.get('solicitante')}`,
                        notes: taskDescription,
                        projects: ["1211417468444116"], // Project ID fornecido
                        due_on: dueOn,
                        custom_fields: {
                            // Voc√™ pode adicionar campos personalizados aqui se necess√°rio
                        }
                    }
                };

                try {
                    const response = await fetch('https://app.asana.com/api/1.0/tasks', {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer 2/1143982264182678/1211417468387463:c67e022d15d2ec650ae50e9cc18da980',
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(taskData)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('Tarefa criada no Asana:', result);
                        return { success: true, task: result.data };
                    } else {
                        const error = await response.text();
                        console.error('Erro ao criar tarefa no Asana:', error);
                        return { success: false, error: error };
                    }
                } catch (error) {
                    console.error('Erro de rede ao criar tarefa no Asana:', error);
                    return { success: false, error: error.message };
                }
            }

            sendEmailButton.addEventListener('click', async function() {
                // Desabilita o bot√£o temporariamente
                sendEmailButton.disabled = true;
                sendEmailButton.innerHTML = `
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Criando tarefa...
                `;

                try {
                    // Cria a tarefa no Asana
                    const asanaResult = await createAsanaTask();
                    
                    if (asanaResult.success) {
                        // Atualiza o bot√£o para sucesso
                        sendEmailButton.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            <span>Tarefa criada com sucesso!</span>
                        `;
                        
                    } else {
                        // Se houve erro, mostra mensagem de erro
                        sendEmailButton.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                            </svg>
                            <span>Erro ao criar tarefa</span>
                        `;
                    }
                    
                } catch (error) {
                    console.error('Erro geral:', error);
                    
                    // Em caso de erro, mostra mensagem de erro
                    sendEmailButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
                        </svg>
                        <span>Erro ao criar tarefa</span>
                    `;
                }
                
                // Reabilita o bot√£o ap√≥s um tempo
                setTimeout(() => {
                    sendEmailButton.disabled = false;
                    sendEmailButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>Criar Tarefa no Asana</span>
                    `;
                }, 3000);
            });

            // L√≥gica dos Modais
            const contextModal = document.getElementById('contextModal');
            const closeContextModalBtn = document.getElementById('closeContextModalBtn');
            const objetivoModal = document.getElementById('objetivoModal');
            const closeObjetivoModalBtn = document.getElementById('closeObjetivoModalBtn');
            const reqFuncionaisModal = document.getElementById('reqFuncionaisModal');
            const closeReqFuncionaisModalBtn = document.getElementById('closeReqFuncionaisModalBtn');
            const reqTecnicosModal = document.getElementById('reqTecnicosModal');
            const closeReqTecnicosModalBtn = document.getElementById('closeReqTecnicosModalBtn');
            const usuariosModal = document.getElementById('usuariosModal');
            const closeUsuariosModalBtn = document.getElementById('closeUsuariosModalBtn');
            const recursosModal = document.getElementById('recursosModal');
            const closeRecursosModalBtn = document.getElementById('closeRecursosModalBtn');
            const impactoModal = document.getElementById('impactoModal');
            const closeImpactoModalBtn = document.getElementById('closeImpactoModalBtn');

            chatContainer.addEventListener('click', (e) => {
                const infoBtn = e.target.closest('.priority-info-btn');
                if (infoBtn) {
                    priorityModal.classList.remove('hidden');
                    priorityModal.classList.add('flex');
                }

                const contextInfoBtn = e.target.closest('.context-info-btn');
                if (contextInfoBtn) {
                    contextModal.classList.remove('hidden');
                    contextModal.classList.add('flex');
                }

                const objetivoInfoBtn = e.target.closest('.objetivo-info-btn');
                if (objetivoInfoBtn) {
                    objetivoModal.classList.remove('hidden');
                    objetivoModal.classList.add('flex');
                }

                const reqFuncionaisInfoBtn = e.target.closest('.reqFuncionais-info-btn');
                if (reqFuncionaisInfoBtn) {
                    reqFuncionaisModal.classList.remove('hidden');
                    reqFuncionaisModal.classList.add('flex');
                }

                const reqTecnicosInfoBtn = e.target.closest('.reqTecnicos-info-btn');
                if (reqTecnicosInfoBtn) {
                    reqTecnicosModal.classList.remove('hidden');
                    reqTecnicosModal.classList.add('flex');
                }

                const usuariosInfoBtn = e.target.closest('.usuarios-info-btn');
                if (usuariosInfoBtn) {
                    usuariosModal.classList.remove('hidden');
                    usuariosModal.classList.add('flex');
                }

                const recursosInfoBtn = e.target.closest('.recursos-info-btn');
                if (recursosInfoBtn) {
                    recursosModal.classList.remove('hidden');
                    recursosModal.classList.add('flex');
                }

                const impactoInfoBtn = e.target.closest('.impacto-info-btn');
                if (impactoInfoBtn) {
                    impactoModal.classList.remove('hidden');
                    impactoModal.classList.add('flex');
                }
            });
            
            closeModalBtn.addEventListener('click', () => {
                priorityModal.classList.add('hidden');
                priorityModal.classList.remove('flex');
            });

            closeContextModalBtn.addEventListener('click', () => {
                contextModal.classList.add('hidden');
                contextModal.classList.remove('flex');
            });

            closeObjetivoModalBtn.addEventListener('click', () => {
                objetivoModal.classList.add('hidden');
                objetivoModal.classList.remove('flex');
            });

            closeReqFuncionaisModalBtn.addEventListener('click', () => {
                reqFuncionaisModal.classList.add('hidden');
                reqFuncionaisModal.classList.remove('flex');
            });

            closeReqTecnicosModalBtn.addEventListener('click', () => {
                reqTecnicosModal.classList.add('hidden');
                reqTecnicosModal.classList.remove('flex');
            });

            closeUsuariosModalBtn.addEventListener('click', () => {
                usuariosModal.classList.add('hidden');
                usuariosModal.classList.remove('flex');
            });

            closeRecursosModalBtn.addEventListener('click', () => {
                recursosModal.classList.add('hidden');
                recursosModal.classList.remove('flex');
            });

            closeImpactoModalBtn.addEventListener('click', () => {
                impactoModal.classList.add('hidden');
                impactoModal.classList.remove('flex');
            });

            priorityModal.addEventListener('click', (e) => {
                if (e.target === priorityModal) {
                    priorityModal.classList.add('hidden');
                    priorityModal.classList.remove('flex');
                }
            });

            contextModal.addEventListener('click', (e) => {
                if (e.target === contextModal) {
                    contextModal.classList.add('hidden');
                    contextModal.classList.remove('flex');
                }
            });

            objetivoModal.addEventListener('click', (e) => {
                if (e.target === objetivoModal) {
                    objetivoModal.classList.add('hidden');
                    objetivoModal.classList.remove('flex');
                }
            });

            reqFuncionaisModal.addEventListener('click', (e) => {
                if (e.target === reqFuncionaisModal) {
                    reqFuncionaisModal.classList.add('hidden');
                    reqFuncionaisModal.classList.remove('flex');
                }
            });

            reqTecnicosModal.addEventListener('click', (e) => {
                if (e.target === reqTecnicosModal) {
                    reqTecnicosModal.classList.add('hidden');
                    reqTecnicosModal.classList.remove('flex');
                }
            });

            usuariosModal.addEventListener('click', (e) => {
                if (e.target === usuariosModal) {
                    usuariosModal.classList.add('hidden');
                    usuariosModal.classList.remove('flex');
                }
            });

            recursosModal.addEventListener('click', (e) => {
                if (e.target === recursosModal) {
                    recursosModal.classList.add('hidden');
                    recursosModal.classList.remove('flex');
                }
            });

            impactoModal.addEventListener('click', (e) => {
                if (e.target === impactoModal) {
                    impactoModal.classList.add('hidden');
                    impactoModal.classList.remove('flex');
                }
            });
        });
    </script>
</body>
</html>

